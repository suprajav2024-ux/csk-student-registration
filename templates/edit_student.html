{% extends "base.html" %}
{% block content %}

<div class="container py-5">
    <div class="card shadow-sm p-4 mx-auto" style="max-width: 900px;">
        <h2 class="text-center mb-4">Edit Student</h2>

        <form method="POST">

            <!-- Student Info -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Student Name</label>
                    <input type="text" class="form-control" name="name" value="{{ student.name }}" required>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Grade</label>
                    <select class="form-select" id="grade_select" name="grade" required>
                        {% for g in ['I','II','III','IV','V','VI','VII','VIII'] %}
                            <option value="{{ g }}" {% if student.grade == g %}selected{% endif %}>{{ g }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Section</label>
                    <select class="form-select" name="section" required>
                        {% for s in ['A','B','C'] %}
                            <option value="{{ s }}" {% if student.section == s %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Events -->
            <h5 class="mt-4">Events</h5>
            <div class="row">

                {% set slots = [
                    ('10-11am','event_10_11', student.event_10_11),
                    ('11-12pm','event_11_12', student.event_11_12),
                    ('1-2pm','event_1_2', student.event_1_2),
                    ('2-3pm','event_2_3', student.event_2_3)
                ] %}

                {% for label, name, selected in slots %}
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">{{ label }}</label>
                    <select class="form-select event-slot" id="{{ name }}" name="{{ name }}">
                        <option value="Not participating"
                            {% if selected == "Not participating" %}selected{% endif %}>
                            Not participating
                        </option>

                        {% for ev in event_options[student.grade][label] %}
                            {% if ev != "Not participating" %}
                            <option value="{{ ev }}"
                                {% if selected == ev %}selected{% endif %}>
                                {{ ev }}
                            </option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                {% endfor %}

            </div>

            <button class="btn btn-primary w-100 mt-4">Update Student</button>
        </form>
    </div>
</div>

<script>
const eventSlotMap = {{ event_slot_map | tojson }};

function setupAutoSelect(fromId, toId) {
    const from = document.getElementById(fromId);
    const to = document.getElementById(toId);

    from.addEventListener("change", () => {
        const selected = from.value;
        if (selected === "Not participating") return;

        if (eventSlotMap[selected]) {
            for (let opt of to.options) {
                if (opt.value === selected) {
                    to.value = selected;
                }
            }
        }
    });
}

document.addEventListener("DOMContentLoaded", () => {
    setupAutoSelect("event_10_11", "event_11_12");
    setupAutoSelect("event_11_12", "event_1_2");
    setupAutoSelect("event_1_2", "event_2_3");
});
</script>

{% endblock %}
